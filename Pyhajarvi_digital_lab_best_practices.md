---
file: Pyhajarvi_digital_lab_best_practices.md
author:
- Chedly Kastally <chedly.kastally@oulu.fi
- Tanja Pyhäjärvi <tanja.pyhajarvi@oulu.fi>
date of creation: 2020-01-14 10:31
---
# Best practices for digital lab working
## File organization in Puhti
In Puhti, there is very limited space available for each user. Each project,
however, has its own dedicated space where files can be stored. That space is
called "scratch" because it is meant to be a temporary space for file storing,
that can and will be "scratched", ie emptied, by the server administrators.
When starting on a new project, the scratch folder associated with that project
is generated automatically and is located in the directory:
"/scratch/project_ID"
### User specific space
Since multiple users might work on the same project, and to avoid confusion,
each user should create in the scratch its own folder where he can store his
files. This user-specific folder should be named with the last name of the user
so that it is clear where each user is working.
Result files generated by each user should be, as soon as possible, uploaded in
Allas/Pouta for further use and the scratch should be cleaned regularly as the
disk memory is limited on the server.
    # eg for a project named "project_2001218":
    cd /scratch/project_2001218
    mkdir ./my_last_name
    cd ./my_last_name
    # start working
Some files can be stored in the root directory of the project, eg raw data or
a reference genome, to avoid having each user storing their own copies of the
same files multiple times in the server:
    # Examples of non user-specific folders and files at the root directory of
    # a project, used by multiple users:
    # Raw data:
    /scratch/project_2001218/raw_data/Illumina_2019-02-01/sample_01_R1.fastq.gz
    /scratch/project_2001218/raw_data/Illumina_2019-02-01/sample_01_R2.fastq.gz
    /scratch/project_2001218/raw_data/Illumina_2019-02-01/sample_02_R1.fastq.gz
    /scratch/project_2001218/raw_data/Illumina_2019-02-01/sample_02_R2.fastq.gz
    # Reference genomes:
    /scratch/project_2001218/reference/ptaeda/Pita.2_01_cp_mt.fa.gz
## File organization in Pouta/Allas:
Pouta/Allas is where files can be stored when they are not being processing in
Puhti. You should have there:
- raw data
- reference files, used regularly across analyses, eg reference genomes and indexing
- result files of your analyses
- temporary files that need to be saved and kept as backup but will be removed
  once they have served their purpose. Those should be removed as quickly as
  possible, eg once the project is ended, or/and that it is clear that they
  won't be needed right away.
Data in Pouta/Allas is organized by projects. Each project has any number of
"container", inside which "objects" are stored. These objects can contains
single or multiple files.
Some guidelines:
- raw data should be kept on its own, in clear and separate containers
- Containers should be organized by type of results (eg vcf files) and/or data
    - result files from each type of analyses should be kept separated
    - not really appropriate for code storing, but in doubt, store it there too.
    - you can also store the .out files generated by the jobs, but organize
      them in a clear way if you do (eg use appropriate file names and tar the
      files together)
- Avoid storing intermediary/temporary files: someone should need only your code
  and the raw data to be able to reproduce your analyses and producing the end
  result files.
- Files should be compressed (.vcf.gz, .tsv.gz, ...)
        gzip -c project_2001218_raw_snps.vcf > project_2001218_raw_snps.vcf.gz
- if many files are parts of the same result and it make sense to keep them
  together, tar a directory containing all the files together to store it in Pouta
        tar -czf result_files.tar.gz all_result_files_directory/
## Files naming recommendations
Every result file should be uploaded to Allas/Pouta in the appropriate
container (associated with the correct project) with clear documentation on how
the file was generated and/or what it contains.
A good name for a file:
    - has NO space, no accentuated character
    - has no non alpha-numerical character, outside of '-' or '\_' (no comma, no single-quote,...)
    - has no entirely capitalized words
        eg: "STRUCTURE_K2_RUN-1_result.txt", is better named "Structure_K2_run-1_result.txt"
    - is a trade-off between clarity and information:
            "very_important_file" is not informative
            "final_result"        is not really useful either
        - it should be as informative as possible to describe its content
            - project? species? parameters?
            - has a clear and appropriate format (.vcf .tsv .csv .txt .bed .fastq .fasta)
        - while remaining concise and clear: avoid, as much as possible, long
          names, it will be less and less readable as it gets longer.
When generating a new version of a file, eg after filtering, some options to
make it clear for future users what version of the file should be used:
- you can include the date in the file name (use the ISO date format, ie
  YYYY-MM-DD)
- keep only the final version of the file, that is used in subsequent analyses,
  and/or that is used in the publication. If a version will most likely never be
  used again, delete it, or change its name to reflect that this file is
  probably not the one to be used (eg prefix the file with "old_" or
  "deprecated_"), and ideally, move it to a distinct archive location (eg put
  old version in a folder "archive/YYYY-MM-DD"). It should be safe to assume
  that "old_" files can be safely removed after a few months if they have never
  been used again.
## Useful links
### CSC documentation:
- my_csc:
    - https://my.csc.fi/
    
- Pouta/Allas:
    - https://pouta.csc.fi/dashboard
### Tutorials:
- Pouta/allas:
    - https://docs.csc.fi/#data/Allas/
    - https://docs.csc.fi/#data/Allas/using_allas/common_use_cases/
- ida-storage:
https://docs.csc.fi/#data/ida/using_ida
- Transfering from taito to puhti
https://docs.csc.fi/#data/Allas/migration_tutorial/
